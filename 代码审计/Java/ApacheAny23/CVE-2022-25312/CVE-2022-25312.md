- [CVE-2022-25312 ApacheAny23 XXE](#cve-2022-25312-apacheany23-xxe)
  - [影响版本](#影响版本)
  - [环境搭建](#环境搭建)
  - [原理分析](#原理分析)
    - [XSLTStylesheet](#xsltstylesheet)
    - [关于XSLT](#关于xslt)
      - [XSLT格式](#xslt格式)
  - [漏洞复现](#漏洞复现)
  - [补丁分析](#补丁分析)
# CVE-2022-25312 ApacheAny23 XXE
## 影响版本
Version < 2.7
## 环境搭建
```xml
        <dependency>
            <groupId>org.apache.any23</groupId>
            <artifactId>apache-any23-core</artifactId>
            <version>2.6</version>
        </dependency>
```
## 原理分析
### XSLTStylesheet
漏洞在于rdfa的XSLTStylesheet解析器在解析用户输入的XSLT样式表时未设置相关安全配置,导致XXE。
![](1.png)
使用的是`TransformerFactory`的默认配置进行解析。
### 关于XSLT
XSLT指XSL转换(XSL Transformations)。  
XSL指扩展样式表语言(EXtensible Stylesheet Language),它是一个XML文档的样式表语言。  
利用XSLT可以将XML文档转换为另一种XML文档。  
XSLT使用XPath在XML文档中进行导航

#### XSLT格式
把文档声明为 XSL 样式表的根元素是 `<xsl:stylesheet>` 或 `<xsl:transform>`。
```xml
<xsl:stylesheet version="1.0"
xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
```
完整示例:
```xml
<?xml version="1.0" encoding="ISO-8859-1"?>
<xsl:stylesheet version="1.0"
xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
<xsl:template match="/">
<html>
<body>
<h2>My CD Collection</h2>
<table border="1">
<tr bgcolor="#9acd32">
<th>Title</th>
<th>Artist</th>
</tr>
<xsl:for-each select="catalog/cd">
<tr>
<td><xsl:value-of select="title"/></td>
<td><xsl:value-of select="artist"/></td>
</tr>
</xsl:for-each>
</table>
</body>
</html>
</xsl:template>
</xsl:stylesheet>
```
XXE时,payload实体声明位置在`<?xml version="1.0" encoding="ISO-8859-1"?>`和`<xsl:stylesheet version="1.0"`之间。
## 漏洞复现
![](2.png)
## 补丁分析
![](3.png)
设置相关实体访问属性，禁止外部实体加载。

